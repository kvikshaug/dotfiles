#!/usr/bin/fish
# Runs .dwmsb-mail-filter and saves the output in $mailfile
# $mailfile is checked by .dwmsb
#
# Mail is checked seperately from .dwmsb in order to be able to pull
# less frequently than the status bar is updated
#
# The job is started in .xinitrc

# The connection between this file and .dwmsb
set mailfile .dwmsb-mail-current

# Use a temporary file to store the atom feed data
set tmpfile (mktemp .dwmsb-tempfile.XXXXXXXX)
curl -u (~/.gc) --silent https://mail.google.com/mail/feed/atom > $tmpfile

# if curl fails, say so
set curlstatus $status
if test $curlstatus -ne 0
  echo -n "curl: $curlstatus | " > $mailfile
else
  set result (scala .dwmsb-mail-filter.scala $tmpfile)
  echo $result > $mailfile
end

/bin/rm $tmpfile

